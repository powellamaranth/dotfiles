#!/usr/bin/env bash

# install asdf
rm -fr $HOME/.asdf
git clone https://github.com/asdf-vm/asdf.git $HOME/.asdf --branch v0.9.0

# checkout
rm -fr $HOME/.dotfiles
git clone "https://github.com/danielgatis/dotfiles.git" "$HOME/.dotfiles"

# copy dotfiles to home
declare -a FILES_TO_SYMLINK=$(find $HOME/.dotfiles -type f -maxdepth 1 -name ".*" -not -name init.lua -not -name .DS_Store -not -name .git -exec basename {} \;)

for i in ${FILES_TO_SYMLINK[@]}; do
  sourceFile="$HOME/.dotfiles/$i"
  targetFile="$HOME/$(printf "%s" "$i" | sed "s/.*\/\(.*\)/\1/g")"
  ln -fs $sourceFile $targetFile
  echo "${sourceFile} → ${targetFile}"
done

# copy init.lua
mkdir -p $HOME/.config/nvim
ln -fs $HOME/.dotfiles/init.lua $HOME/.config/nvim/init.lua
echo "$HOME/.dotfiles/init.lua → $HOME/.config/nvim/init.lua"

# install homewbrew and bundle
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew bundle --global --force --no-lock || true

# install nvim plugins
rm -fr $HOME/.config/nvim/plugin/packer_compiled.lua
nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
